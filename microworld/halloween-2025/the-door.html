<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Official website of ThePropHat - My personal projects, hobbies, and blog posts." />
<meta property="og:title" content="www.theprophat.com" />
<meta property="og:image" content="/images/logos/site-logo.png" />
<title>THEPROPHAT.COM</title>
<link rel="stylesheet" href="styles.css" />
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>
  <div id="instruction">TRICK OR TREAT!</div>

  <div id="door-container">
    <div id="frame">
      <div id="outcome"></div>
    </div>
    <div id="door">
      <div id="knob"></div>
    </div>
  </div>

  <div id="inventory-panel">
    <h2>MY HAUL</h2>
    <ul id="inventory-list"></ul>
    <button id="reset-progress">EMPTY BAG</button>
    <button id="submit-score-btn">SUBMIT SCORE</button>
  </div>

  

  <button id="closeBtn">Close Door</button>

  <div id="confirm-modal" class="modal hidden">
    <div class="modal-content">
      <p>This will restart your haul. Are you sure you want to do that?</p>
      <div class="modal-buttons">
        <button id="confirm-yes">Yes, I want to restart</button>
        <button id="confirm-no">No, I want to keep my candy</button>
      </div>
    </div>
  </div>

  <div id="score-modal" class="modal hidden">
  <div class="modal-content">
    <p id="score-message"></p>
    <div class="modal-buttons">
      <button id="score-close-btn">Close</button>
    </div>
  </div>
</div>


  <script>
   
    const firebaseConfig = {
      apiKey: "AIzaSyDjKxw294bqm4i9I5tjO7TrQV_jjW4En4g",
      authDomain: "theprophathalloween2025.firebaseapp.com",
      projectId: "theprophathalloween2025",
      storageBucket: "theprophathalloween2025.firebasestorage.app",
      messagingSenderId: "489777678361",
      appId: "1:489777678361:web:f9d424107d8120ca514288"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // DOM references
    const door = document.getElementById("door");
    const frame = document.getElementById("frame");
    const outcome = document.getElementById("outcome");
    const closeBtn = document.getElementById("closeBtn");
    let doorOpen = false;
    const knockSound = new Audio('knock.mp3');
    let inventory = JSON.parse(localStorage.getItem('inventory')) || {};
    let playerName = localStorage.getItem('playerName') || null;

  
    const leaderboardContainer = document.createElement('div');
    leaderboardContainer.id = 'leaderboard-container';
    leaderboardContainer.innerHTML = `
      <h2>HIGH SCORES</h2>
      <ol id="leaderboard-list"></ol>
    `;
    document.body.appendChild(leaderboardContainer);
    const leaderboardList = document.getElementById('leaderboard-list');

  
    const normalOutcomes = [
      { text: "coffee crisp!", image: "coffeecrisp.png", audio: "coffeecrisp.mp3" },
      { text: "aero!", image: "aero.png", audio: "aero.mp3" },
      { text: "cheezies!", image: "cheezies.png", audio: "cheezies.mp3" },
      { text: "a wagon wheel!", image: "wagonwheel.png", audio: "wagonwheel.mp3" },
      { text: "rockets!", image: "rockets.png", audio: "rockets.mp3" },
      { text: "smarties!", image: "smarties.png", audio: "smarties.mp3" },
      { text: "a ton of kitkats!", image: "kitkat.png", audio: "kitkat.mp3" },
      { text: "its a spooky spider ring!", image: "spider.png", audio: "spider.mp3" },
      { text: "a ghost jumps out!", image: "ghost.png", audio: "ghost.mp3" },
      { text: "vampire teeth!", image: "teeth.png", audio: "teeth.mp3" },
      { text: "a rock!", image: "rock.png", audio: "rock.mp3" },
      { text: "The Rock!", image: "therock.png", audio: "therock.mp3" },
      { text: "LOOK BEHIND YOU", image: false, audio: "rock.mp3" },
      { text: "you got the dud...", image: "dud.png", audio: "rock.mp3" },


      { text: "your cat is plotting against you...", image: false, audio: "nothing.mp3" },
      { text: "the door opens, yet no one is there...", image: false, audio: "nothing.mp3" },
      { text: "BOO!", image: false, audio: "nothing.mp3" },
      { text: "you have been cursed for 24 hours...", image: false, audio: "nothing.mp3" },

      { text: "candy corn!", image: "candycorn.png", audio: "nothing.mp3" },
      { text: "an apple!", image: "apple.png", audio: "nothing.mp3" },
      { text: "a peeled tangerine!", image: "orange.png", audio: "nothing.mp3" },
      { text: "a caramilk!", image: "caramilk.png", audio: "nothing.mp3" },
      { text: "a pumpkin shaped snickers!", image: "snickers.png", audio: "nothing.mp3" },
      { text: "a handful of twix!", image: "twix.png", audio: "nothing.mp3" },
      { text: "an unwrapped hershey's kiss!", image: "kiss.png", audio: "nothing.mp3" },
      { text: "a human eye...still warm", image: "eye.png", audio: "nothing.mp3" },
      { text: "toilet paper!", image: "toilet.png", audio: "nothing.mp3" },
      { text: "a juice box!", image: "juice.png", audio: "nothing.mp3" },
      { text: "a half eaten sandwich!", image: "sandwich.png", audio: "nothing.mp3" },
      { text: "obamna...", image: "obamna.png", audio: "nothing.mp3" },
      { text: "minecraft cobblestone!", image: "cobble.png", audio: "nothing.mp3" },
      { text: "gumshoe gooper!", image: "gooper.webp", audio: "nothing.mp3" },
      { text: "potato chips!", image: "chips.png", audio: "nothing.mp3" },
      { text: "twizzlers!", image: "twizzlers.png", audio: "nothing.mp3" },
      { text: "a housefly...", image: "fly.png", audio: "nothing.mp3" },
      { text: "a chupa chup!", image: "chupachup.png", audio: "nothing.mp3" },
      { text: "nasty bubblegum!", image: "gum.png", audio: "nothing.mp3" },


    ];

    const rareOutcomes = [
      { text: "a copy of half life 2!", image: "halflife", audio: "nothing.mp3" },

      { text: "You got the secret button!", image: "button.png", audio: "taxevasion.mp3" },
      { text: "nothing!", image: "sad.png", audio: "nothing.mp3" },
      { text: "YOU HAVE BEEN AUDITED FOR TAX EVASION!", image: false, audio: "taxevasion.mp3" }
    ];


    function playKnocks(count = 1, interval = 250, callback) {
      let knocks = 0;
      const knockInterval = setInterval(() => {
        knockSound.currentTime = 0;
        knockSound.play();
        knocks++;
        if (knocks >= count) {
          clearInterval(knockInterval);
          if (callback) callback();
        }
      }, interval);
    }

   
    function showOutcome(result) {
      door.classList.add("open");
      frame.classList.add("opened");
      doorOpen = true;

      outcome.innerHTML = "";

      const textEl = document.createElement("div");
      textEl.textContent = result.text;
      textEl.style.marginBottom = "8px";
      outcome.appendChild(textEl);

      if (result.image) {
        const imgEl = document.createElement("img");
        imgEl.src = result.image;
        imgEl.alt = "Outcome";
        outcome.appendChild(imgEl);
      }

      if (result.audio) {
        const audioEl = document.createElement("audio");
        audioEl.src = result.audio;
        audioEl.autoplay = true;
        outcome.appendChild(audioEl);
      }

      outcome.classList.add("visible");
      closeBtn.style.display = "inline-block";
    }

    function updateInventoryDisplay() {
      const inventoryList = document.getElementById("inventory-list");
      inventoryList.innerHTML = "";

      for (const itemText in inventory) {
        const li = document.createElement("li");
        li.textContent = `${itemText} Ã— ${inventory[itemText]}`;
        li.style.cursor = "pointer";
        li.title = "Click to replay this treat";

        li.addEventListener("click", () => {
          const allOutcomes = [...normalOutcomes, ...rareOutcomes];
          const match = allOutcomes.find(outcome => outcome.text === itemText);
          if (match) {
            showOutcome(match);
          }
        });

        inventoryList.appendChild(li);
      }
    }


    function saveInventory() {
      localStorage.setItem('inventory', JSON.stringify(inventory));
    }

    
    door.addEventListener("click", () => {
      if (!doorOpen) {
        playKnocks(3, 250, () => {
          const isRare = Math.random() < 0.05;
          const outcomes = isRare ? rareOutcomes : normalOutcomes;
          const result = outcomes[Math.floor(Math.random() * outcomes.length)];

         
          showOutcome(result);

          
          inventory[result.text] = (inventory[result.text] || 0) + 1;
          saveInventory();
          updateInventoryDisplay();
        });
      }
    });

    // Close door event
    closeBtn.addEventListener("click", () => {
      door.classList.remove("open");
      frame.classList.remove("opened");
      doorOpen = false;
      outcome.innerHTML = "";
      closeBtn.style.display = "none";
      randomizeDoorStyle();
    });

    // Random door colors
    function randomizeDoorStyle() {
      const doorColors = [
        'linear-gradient(to bottom, #4b1f1f, #2a0f0f)',
        'linear-gradient(to bottom, #3a2f1f, #1f0f0f)',
        'linear-gradient(to bottom, #2f1f3a, #0f0f1f)',
        'linear-gradient(to bottom, #5a1f1f, #2f0f0f)',
        'linear-gradient(to bottom, #4f2a1f, #1f0f0f)',
        'linear-gradient(to bottom, #3f1f2a, #0f0f1f)',
        'linear-gradient(to bottom, #4b2a1f, #1a0f0f)',
        'linear-gradient(to bottom, #3a1f2f, #0f0f1a)',
        'linear-gradient(to bottom, #5b1f2a, #2f0f14)',
        'linear-gradient(to bottom, #42211f, #1f0f1f)',
        'linear-gradient(to bottom, #4f1f3f, #2a0f1a)',
        'linear-gradient(to bottom, #3f1a2f, #0f0f0f)'
      ];
      door.style.background = doorColors[Math.floor(Math.random() * doorColors.length)];
    }

    // Submit score to Firebase
    function submitScore(name, haulCount) {
      const scoresRef = database.ref('scores');
      scoresRef.push({
        name: name,
        haul: haulCount,
        timestamp: Date.now()
      });
    }

    // Listen for leaderboard updates live
    function listenLeaderboard() {
      const scoresRef = database.ref('scores').orderByChild('haul').limitToLast(10);
      scoresRef.on('value', (snapshot) => {
        const scores = [];
        snapshot.forEach(childSnapshot => {
          scores.push(childSnapshot.val());
        });
        // Sort descending by haul
        scores.sort((a, b) => b.haul - a.haul);

        leaderboardList.innerHTML = "";
        scores.forEach(({name, haul}) => {
          const li = document.createElement('li');
          li.textContent = `${name}: ${haul} treats`;
          leaderboardList.appendChild(li);
        });
      });
    }

 
    const modal = document.getElementById("confirm-modal");
    const confirmYes = document.getElementById("confirm-yes");
    const confirmNo = document.getElementById("confirm-no");

    document.getElementById("reset-progress").addEventListener("click", () => {
      modal.classList.remove("hidden");
    });

    confirmYes.addEventListener("click", () => {
      inventory = {};
      saveInventory();
      updateInventoryDisplay();
      outcome.innerHTML = "";
      door.classList.remove("open");
      frame.classList.remove("opened");
      doorOpen = false;
      closeBtn.style.display = "none";
      randomizeDoorStyle();
      modal.classList.add("hidden");
    });

    confirmNo.addEventListener("click", () => {
      modal.classList.add("hidden");
    });

    const scoreModal = document.getElementById("score-modal");
const scoreMessage = document.getElementById("score-message");
const scoreCloseBtn = document.getElementById("score-close-btn");

scoreCloseBtn.addEventListener("click", () => {
  scoreModal.classList.add("hidden");
});

const submitScoreBtn = document.getElementById('submit-score-btn');

submitScoreBtn.addEventListener('click', () => {
  const haulCount = Object.values(inventory).reduce((a, b) => a + b, 0);
  if (haulCount === 0) {
    alert("you overturn your bag. a single fly is its only contents. maybe you weren't cut out for this?");
    return;
  }
  
  let name = prompt("enter your name for all to see?", playerName || "Guest");
  if (!name) {
    alert("why so shy? give us your name.");
    return;
  }
  playerName = name;
  localStorage.setItem('playerName', playerName);

  submitScore(playerName, haulCount);
  scoreMessage.textContent = `thanks for coming trick or treating with us, ${playerName}! you sure 
  know how to collect a lot of candy! your score of ${haulCount} treats was submitted.`;
scoreModal.classList.remove("hidden");
});

    updateInventoryDisplay();
    randomizeDoorStyle();
    listenLeaderboard();

  </script>
</body>
</html>
